<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Claude Resume - AI-Powered ATS Resume Builder</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#0a0a0a;color:#e0e0e0;line-height:1.6}
.container{max-width:1400px;margin:0 auto;padding:20px}
header{text-align:center;padding:30px 0;border-bottom:1px solid #222}
h1{font-size:2.5em;background:linear-gradient(135deg,#6366f1,#8b5cf6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:10px}
.subtitle{color:#888;font-size:1.1em}
.tabs{display:flex;gap:10px;margin:30px 0;flex-wrap:wrap}
.tab{padding:12px 24px;background:#1a1a1a;border:1px solid #333;border-radius:8px;cursor:pointer;transition:all 0.2s}
.tab:hover{border-color:#6366f1}
.tab.active{background:#6366f1;border-color:#6366f1;color:#fff}
.tab-badge{background:#ef4444;color:#fff;font-size:0.7em;padding:2px 6px;border-radius:10px;margin-left:6px}
.panel{display:none;background:#111;border:1px solid #222;border-radius:12px;padding:30px}
.panel.active{display:block}
h2{font-size:1.5em;margin-bottom:20px;color:#fff}
h3{font-size:1.2em;margin:20px 0 15px;color:#a5a5a5}
.form-group{margin-bottom:20px}
label{display:block;margin-bottom:8px;color:#888;font-size:0.9em}
input,textarea,select{width:100%;padding:12px;background:#1a1a1a;border:1px solid #333;border-radius:8px;color:#fff;font-size:1em}
input:focus,textarea:focus,select:focus{outline:none;border-color:#6366f1}
textarea{min-height:120px;resize:vertical;font-family:inherit}
button{padding:12px 24px;background:#6366f1;color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:1em;transition:all 0.2s}
button:hover{background:#5558e3}
button:disabled{opacity:0.5;cursor:not-allowed}
button.secondary{background:#333}
button.secondary:hover{background:#444}
button.danger{background:#ef4444}
button.danger:hover{background:#dc2626}
button.success{background:#10b981}
button.success:hover{background:#059669}
button.small{padding:6px 12px;font-size:0.85em}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px}
.grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:20px}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}
.grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:15px}
.card{background:#1a1a1a;border:1px solid #333;border-radius:10px;padding:20px}
.card h4{margin-bottom:15px;color:#fff}
.card.highlight{border-color:#6366f1;background:linear-gradient(135deg,#1a1a2e,#16213e)}
.item{background:#222;border-radius:8px;padding:15px;margin-bottom:10px;position:relative}
.item-header{display:flex;justify-content:space-between;align-items:start;margin-bottom:10px}
.item-title{font-weight:600;color:#fff}
.item-subtitle{color:#888;font-size:0.9em}
.item-actions{display:flex;gap:8px}
.item-actions button{padding:5px 10px;font-size:0.8em}
.bullets{margin-top:10px}
.bullet{display:flex;gap:10px;margin-bottom:8px;align-items:start}
.bullet-dot{color:#6366f1;margin-top:2px}
.add-btn{width:100%;padding:15px;background:#1a1a1a;border:2px dashed #333;border-radius:8px;color:#888;cursor:pointer;transition:all 0.2s}
.add-btn:hover{border-color:#6366f1;color:#6366f1}
.tags{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
.tag{background:#333;padding:6px 12px;border-radius:20px;font-size:0.85em;display:flex;align-items:center;gap:6px}
.tag-remove{cursor:pointer;color:#888}
.tag-remove:hover{color:#ef4444}
.tag-input{display:flex;gap:10px;margin-top:10px}
.tag-input input{flex:1}
.tag-input button{white-space:nowrap}
.resources-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:15px}
.resource-card{background:#1a1a1a;border:1px solid #333;border-radius:10px;padding:20px}
.resource-card h4{color:#6366f1;margin-bottom:10px}
.resource-list{list-style:none}
.resource-list li{padding:8px 0;border-bottom:1px solid #222;color:#aaa}
.resource-list li:last-child{border-bottom:none}
.generate-section{text-align:center;padding:40px}
.generate-section h2{margin-bottom:20px}
.generate-btn{font-size:1.2em;padding:16px 40px;background:linear-gradient(135deg,#6366f1,#8b5cf6)}
.generate-btn:hover{opacity:0.9}
.output-section{margin-top:30px}
.score-card{background:linear-gradient(135deg,#1a1a2e,#16213e);border:1px solid #333;border-radius:12px;padding:30px;text-align:center;margin-bottom:20px}
.score{font-size:4em;font-weight:700;background:linear-gradient(135deg,#00ff88,#00cc6a);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.score-label{color:#888;margin-top:10px}
.keywords{margin-top:20px}
.keyword-match{color:#00ff88}
.keyword-missing{color:#ff6b6b}
.resume-output{background:#1a1a1a;border:1px solid #333;border-radius:12px;padding:30px;white-space:pre-wrap;font-family:'Courier New',monospace;line-height:1.8}
.copy-btn{position:absolute;top:15px;right:15px}
.loading{display:none;text-align:center;padding:40px}
.loading.active{display:block}
.spinner{width:50px;height:50px;border:4px solid #333;border-top-color:#6366f1;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 20px}
@keyframes spin{to{transform:rotate(360deg)}}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.8);z-index:1000;align-items:center;justify-content:center}
.modal.active{display:flex}
.modal-content{background:#111;border:1px solid #333;border-radius:12px;padding:30px;width:90%;max-width:800px;max-height:90vh;overflow-y:auto}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.modal-close{background:none;border:none;color:#888;font-size:1.5em;cursor:pointer}
.status{padding:15px;border-radius:8px;margin-bottom:20px;display:none}
.status.success{display:block;background:rgba(0,255,136,0.1);border:1px solid #00ff88;color:#00ff88}
.status.error{display:block;background:rgba(255,107,107,0.1);border:1px solid #ff6b6b;color:#ff6b6b}

/* Dashboard Styles */
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:30px}
.stat-card{background:linear-gradient(135deg,#1a1a2e,#16213e);border:1px solid #333;border-radius:12px;padding:25px;text-align:center}
.stat-value{font-size:3em;font-weight:700;color:#6366f1}
.stat-label{color:#888;margin-top:5px;font-size:0.9em}
.stat-card.success .stat-value{color:#10b981}
.stat-card.warning .stat-value{color:#f59e0b}
.stat-card.danger .stat-value{color:#ef4444}
.activity-list{max-height:400px;overflow-y:auto}
.activity-item{display:flex;align-items:center;gap:15px;padding:15px;border-bottom:1px solid #222}
.activity-icon{width:40px;height:40px;border-radius:50%;background:#333;display:flex;align-items:center;justify-content:center;font-size:1.2em}
.activity-content{flex:1}
.activity-title{color:#fff;font-weight:500}
.activity-meta{color:#666;font-size:0.85em}

/* Resume Library Styles */
.library-filters{display:flex;gap:15px;margin-bottom:20px;flex-wrap:wrap;align-items:center}
.library-filters select{width:auto;min-width:150px}
.resume-list{display:grid;gap:15px}
.resume-card{background:#1a1a1a;border:1px solid #333;border-radius:10px;padding:20px;cursor:pointer;transition:all 0.2s}
.resume-card:hover{border-color:#6366f1;transform:translateY(-2px)}
.resume-card-header{display:flex;justify-content:space-between;align-items:start;margin-bottom:10px}
.resume-company{font-weight:600;color:#fff;font-size:1.1em}
.resume-title{color:#888;font-size:0.95em}
.resume-score{font-size:1.5em;font-weight:700}
.resume-score.high{color:#10b981}
.resume-score.medium{color:#f59e0b}
.resume-score.low{color:#ef4444}
.resume-meta{display:flex;gap:15px;margin-top:10px;color:#666;font-size:0.85em}
.status-badge{display:inline-block;padding:4px 10px;border-radius:20px;font-size:0.8em;font-weight:500}
.status-badge.generated{background:#333;color:#888}
.status-badge.applied{background:rgba(99,102,241,0.2);color:#6366f1}
.status-badge.interviewing{background:rgba(245,158,11,0.2);color:#f59e0b}
.status-badge.offered{background:rgba(16,185,129,0.2);color:#10b981}
.status-badge.rejected{background:rgba(239,68,68,0.2);color:#ef4444}
.status-badge.withdrawn{background:rgba(107,114,128,0.2);color:#6b7280}

/* Batch Processing Styles */
.batch-jobs{display:grid;gap:20px}
.batch-job{background:#1a1a1a;border:1px solid #333;border-radius:10px;padding:20px;position:relative}
.batch-job-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}
.batch-job-number{background:#6366f1;color:#fff;width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600}
.remove-job{background:#333;border:none;color:#888;width:30px;height:30px;border-radius:50%;cursor:pointer;font-size:1.2em}
.remove-job:hover{background:#ef4444;color:#fff}
.batch-results{margin-top:30px}
.comparison-card{background:linear-gradient(135deg,#1a1a2e,#16213e);border:1px solid #6366f1;border-radius:12px;padding:25px;margin-bottom:20px}
.ranking-list{display:grid;gap:10px}
.ranking-item{display:flex;align-items:center;gap:15px;background:#222;padding:15px;border-radius:8px}
.ranking-position{font-size:1.5em;font-weight:700;color:#6366f1;width:40px}
.ranking-details{flex:1}
.ranking-company{font-weight:600;color:#fff}
.ranking-title{color:#888;font-size:0.9em}

/* Mobile Responsive */
@media(max-width:768px){
  .grid-2,.grid-3,.grid-4{grid-template-columns:1fr}
  .tabs{justify-content:center}
  .tab{padding:10px 16px;font-size:0.9em}
  .stats-grid{grid-template-columns:repeat(2,1fr)}
  .modal-content{width:95%;padding:20px}
}
</style>
</head>
<body>
<div class="container">
<header>
<div style="display:flex;justify-content:space-between;align-items:center">
<div>
<h1>Claude Resume</h1>
<p class="subtitle">AI-Powered ATS Resume Builder - Tailored for Every Job</p>
</div>
<div id="authSection">
<button onclick="loginWithGoogle()" class="secondary" style="display:flex;align-items:center;gap:10px">
<svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
Sign in with Google
</button>
</div>
</div>
<div id="userInfo" style="display:none;text-align:right;margin-top:10px">
<span id="userName" style="color:#888"></span>
<button onclick="logout()" class="secondary" style="margin-left:10px;padding:6px 12px;font-size:0.85em">Logout</button>
</div>
</header>

<div class="tabs">
<div class="tab active" data-tab="dashboard">Dashboard</div>
<div class="tab" data-tab="profile">Profile</div>
<div class="tab" data-tab="experience">Experience</div>
<div class="tab" data-tab="skills">Skills</div>
<div class="tab" data-tab="generate">Generate</div>
<div class="tab" data-tab="batch">Batch Jobs</div>
<div class="tab" data-tab="library">Library<span class="tab-badge" id="libraryBadge" style="display:none">0</span></div>
<div class="tab" data-tab="resources">Best Practices</div>
</div>

<!-- Dashboard Panel -->
<div class="panel active" id="dashboard">
<h2>Dashboard</h2>

<div class="stats-grid" id="dashboardStats">
<div class="stat-card">
<div class="stat-value" id="statTotal">0</div>
<div class="stat-label">Total Resumes</div>
</div>
<div class="stat-card success">
<div class="stat-value" id="statAvgScore">0%</div>
<div class="stat-label">Avg Match Score</div>
</div>
<div class="stat-card">
<div class="stat-value" id="statApplied">0</div>
<div class="stat-label">Applied</div>
</div>
<div class="stat-card warning">
<div class="stat-value" id="statInterviewing">0</div>
<div class="stat-label">Interviewing</div>
</div>
<div class="stat-card success">
<div class="stat-value" id="statOffered">0</div>
<div class="stat-label">Offers</div>
</div>
</div>

<div class="grid-2">
<div class="card">
<h4>Quick Actions</h4>
<div style="display:grid;gap:10px;margin-top:15px">
<button onclick="switchTab('generate')" style="text-align:left;padding:15px">
<strong>Generate New Resume</strong><br>
<span style="color:#888;font-size:0.9em">Tailor your resume for a specific job</span>
</button>
<button onclick="switchTab('batch')" class="secondary" style="text-align:left;padding:15px">
<strong>Batch Process Jobs</strong><br>
<span style="color:#888;font-size:0.9em">Compare fit across multiple positions</span>
</button>
<button onclick="switchTab('library')" class="secondary" style="text-align:left;padding:15px">
<strong>View Resume Library</strong><br>
<span style="color:#888;font-size:0.9em">Manage saved resumes and track applications</span>
</button>
</div>
</div>

<div class="card">
<h4>Recent Activity</h4>
<div class="activity-list" id="recentActivity">
<div style="color:#666;padding:20px;text-align:center">
<p>No recent activity</p>
<p style="font-size:0.9em;margin-top:10px">Generate your first tailored resume to get started</p>
</div>
</div>
</div>
</div>

<div class="card" style="margin-top:20px">
<h4>Profile Completeness</h4>
<div id="profileCompleteness" style="margin-top:15px">
<div style="display:flex;justify-content:space-between;margin-bottom:8px">
<span>Profile completion</span>
<span id="completenessPercent">0%</span>
</div>
<div style="background:#333;height:8px;border-radius:4px;overflow:hidden">
<div id="completenessBar" style="background:linear-gradient(90deg,#6366f1,#8b5cf6);height:100%;width:0%;transition:width 0.3s"></div>
</div>
<div id="completenessHints" style="margin-top:15px;color:#888;font-size:0.9em"></div>
</div>
</div>
</div>

<!-- Profile Panel -->
<div class="panel" id="profile">

<!-- Import Section -->
<div class="card" style="margin-bottom:30px;background:linear-gradient(135deg,#1a1a2e,#16213e)">
<h4 style="color:#8b5cf6;margin-bottom:15px">Import Your Data</h4>

<div class="grid" style="margin-bottom:20px">
<div>
<label style="color:#0077b5;font-weight:600">LinkedIn Data Export</label>
<p style="color:#888;font-size:0.85em;margin:5px 0 10px">Download from LinkedIn Settings Data Privacy Get a copy of your data</p>
<input type="file" id="linkedinZip" accept=".zip" onchange="parseLinkedInZip(this.files[0])" style="display:none">
<button onclick="document.getElementById('linkedinZip').click()" class="secondary" style="width:100%">
Upload LinkedIn ZIP
</button>
</div>
<div>
<label style="color:#6366f1;font-weight:600">Paste Resume Text</label>
<p style="color:#888;font-size:0.85em;margin:5px 0 10px">Copy/paste from any document</p>
<button onclick="document.getElementById('resumeTextModal').classList.add('active')" class="secondary" style="width:100%">
Paste Resume Text
</button>
</div>
</div>
<div id="importStatus" style="color:#00ff88;font-size:0.9em"></div>
</div>

<!-- Resume Text Modal -->
<div class="modal" id="resumeTextModal">
<div class="modal-content">
<div class="modal-header">
<h3>Paste Resume Text</h3>
<button class="modal-close" onclick="document.getElementById('resumeTextModal').classList.remove('active')">&times;</button>
</div>
<textarea id="importResume" rows="12" placeholder="Paste your resume text here..."></textarea>
<div style="margin-top:15px;display:flex;gap:10px">
<button onclick="parseResumeWithAI()">Parse with AI</button>
<span id="parseStatus" style="color:#888;line-height:45px"></span>
</div>
</div>
</div>

<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
<h2 style="margin:0">Personal Information</h2>
<span id="saveStatus" style="color:#00ff88;font-size:0.9em"></span>
</div>
<div class="grid">
<div class="form-group">
<label>Full Name</label>
<input type="text" id="fullName" placeholder="John Doe">
</div>
<div class="form-group">
<label>Email</label>
<input type="email" id="email" placeholder="john@example.com">
</div>
<div class="form-group">
<label>Phone</label>
<input type="tel" id="phone" placeholder="+1 (555) 123-4567">
</div>
<div class="form-group">
<label>Location</label>
<input type="text" id="location" placeholder="New York, NY">
</div>
<div class="form-group">
<label>LinkedIn URL</label>
<input type="url" id="linkedin" placeholder="https://linkedin.com/in/johndoe">
</div>
<div class="form-group">
<label>GitHub URL</label>
<input type="url" id="github" placeholder="https://github.com/johndoe">
</div>
<div class="form-group">
<label>Portfolio/Website</label>
<input type="url" id="portfolio" placeholder="https://johndoe.com">
</div>
</div>
<div class="form-group">
<label>Professional Summary (Master version - will be tailored per job)</label>
<textarea id="summary" placeholder="Experienced software engineer with 5+ years..."></textarea>
</div>
<button onclick="saveProfile()">Save Profile</button>
</div>

<!-- Experience Panel -->
<div class="panel" id="experience">
<h2>Work Experience</h2>
<div id="experienceList"></div>
<div class="add-btn" onclick="openModal('experience')">+ Add Work Experience</div>

<h2 style="margin-top:40px">Education</h2>
<div id="educationList"></div>
<div class="add-btn" onclick="openModal('education')">+ Add Education</div>

<h2 style="margin-top:40px">Certifications</h2>
<div id="certsList"></div>
<div class="add-btn" onclick="openModal('cert')">+ Add Certification</div>
</div>

<!-- Skills Panel -->
<div class="panel" id="skills">
<div class="grid">
<div class="card">
<h4>Technical Skills</h4>
<div id="technicalSkills" class="tags"></div>
<div class="tag-input">
<input type="text" id="techSkillInput" placeholder="e.g., Python, React, AWS">
<button onclick="addSkill('technical')">Add</button>
</div>
</div>
<div class="card">
<h4>Soft Skills</h4>
<div id="softSkills" class="tags"></div>
<div class="tag-input">
<input type="text" id="softSkillInput" placeholder="e.g., Leadership, Communication">
<button onclick="addSkill('soft')">Add</button>
</div>
</div>
<div class="card">
<h4>Tools & Technologies</h4>
<div id="tools" class="tags"></div>
<div class="tag-input">
<input type="text" id="toolInput" placeholder="e.g., Git, Docker, Jira">
<button onclick="addSkill('tools')">Add</button>
</div>
</div>
<div class="card">
<h4>Interests & Hobbies</h4>
<p style="color:#888;font-size:0.9em;margin-bottom:10px">Personal touches that make you memorable</p>
<div id="interests" class="tags"></div>
<div class="tag-input">
<input type="text" id="interestInput" placeholder="e.g., Open source, Rock climbing">
<button onclick="addSkill('interests')">Add</button>
</div>
</div>
</div>
</div>

<!-- Generate Panel -->
<div class="panel" id="generate">
<h2>Generate Tailored Resume</h2>
<div class="form-group">
<label>Paste Job Description</label>
<textarea id="jobDescription" rows="10" placeholder="Paste the full job description here..."></textarea>
</div>
<div class="grid-2">
<div class="form-group">
<label>Company Name (optional)</label>
<input type="text" id="jobCompany" placeholder="e.g., Google">
</div>
<div class="form-group">
<label>Target Role (optional override)</label>
<input type="text" id="targetRole" placeholder="e.g., Senior Software Engineer">
</div>
</div>
<div class="form-group">
<label>Additional Instructions (optional)</label>
<textarea id="additionalInstructions" rows="3" placeholder="e.g., Emphasize leadership experience, downplay older roles..."></textarea>
</div>
<div class="generate-section">
<button class="generate-btn" onclick="generateResume()">Generate ATS-Optimized Resume</button>
</div>
<div class="loading" id="loading">
<div class="spinner"></div>
<p>Analyzing job description and tailoring your resume...</p>
</div>
<div class="output-section" id="output" style="display:none">

<!-- Score Card -->
<div class="score-card">
<div class="score" id="atsScore">--</div>
<div class="score-label">ATS Match Score</div>
<div class="keywords" id="keywordAnalysis"></div>
</div>

<!-- Save to Library Button -->
<div style="text-align:center;margin-bottom:20px">
<button onclick="saveCurrentResume()" class="success" id="saveToLibraryBtn">Save to Library</button>
</div>

<!-- Relevance Rankings -->
<div class="card" style="margin-bottom:20px">
<h4 style="color:#8b5cf6;margin-bottom:15px">Experience Relevance Rankings</h4>
<div id="relevanceRankings" style="white-space:pre-wrap;color:#aaa"></div>
</div>

<!-- Tailored Summary -->
<div class="card" style="margin-bottom:20px">
<h4 style="color:#6366f1;margin-bottom:15px">Tailored Professional Summary</h4>
<div id="tailoredSummary" style="font-style:italic;color:#ddd"></div>
</div>

<!-- Resume Output -->
<div class="card" style="margin-bottom:20px;position:relative">
<h4 style="color:#00ff88;margin-bottom:15px">ATS-Optimized Resume</h4>
<button class="copy-btn secondary" onclick="copyResume()" style="position:absolute;top:15px;right:15px">Copy Resume</button>
<div class="resume-output" id="resumeOutput"></div>
</div>

<!-- Recruiter Assessment -->
<div class="card" style="background:linear-gradient(135deg,#1a1a2e,#16213e)">
<h4 style="color:#f59e0b;margin-bottom:15px">Recruiter Assessment</h4>
<div id="recruiterAssessment" style="white-space:pre-wrap;line-height:1.8"></div>
</div>

</div>
</div>

<!-- Batch Processing Panel -->
<div class="panel" id="batch">
<h2>Batch Process Multiple Jobs</h2>
<p style="color:#888;margin-bottom:20px">Compare your fit across multiple positions simultaneously (up to 5 jobs)</p>

<div class="batch-jobs" id="batchJobsList">
<div class="batch-job" data-index="0">
<div class="batch-job-header">
<div class="batch-job-number">1</div>
<button class="remove-job" onclick="removeBatchJob(0)" style="display:none">&times;</button>
</div>
<div class="grid-2">
<div class="form-group">
<label>Company Name</label>
<input type="text" class="batch-company" placeholder="e.g., Google">
</div>
<div class="form-group">
<label>Job Title</label>
<input type="text" class="batch-title" placeholder="e.g., Software Engineer">
</div>
</div>
<div class="form-group">
<label>Job URL (optional)</label>
<input type="url" class="batch-url" placeholder="https://...">
</div>
<div class="form-group">
<label>Job Description</label>
<textarea class="batch-jd" rows="6" placeholder="Paste the job description here..."></textarea>
</div>
</div>
</div>

<button onclick="addBatchJob()" class="secondary" style="width:100%;margin-top:10px" id="addJobBtn">+ Add Another Job</button>

<div class="generate-section" style="margin-top:20px">
<button class="generate-btn" onclick="processBatchJobs()">Process All Jobs</button>
</div>

<div class="loading" id="batchLoading">
<div class="spinner"></div>
<p>Processing all jobs in parallel...</p>
</div>

<div class="batch-results" id="batchResults" style="display:none">
<div class="comparison-card">
<h3 style="color:#fff;margin-bottom:15px">Comparison Summary</h3>
<p id="batchSummary" style="color:#aaa"></p>
<div id="batchRecommendation" style="margin-top:15px;padding:15px;background:#222;border-radius:8px"></div>
</div>

<h3 style="margin-bottom:15px">Rankings (Best Fit First)</h3>
<div class="ranking-list" id="batchRankings"></div>

<h3 style="margin-top:30px;margin-bottom:15px">Detailed Results</h3>
<div id="batchDetailedResults"></div>
</div>
</div>

<!-- Resume Library Panel -->
<div class="panel" id="library">
<h2>Resume Library</h2>

<div class="library-filters">
<select id="libraryStatusFilter" onchange="loadLibrary()">
<option value="all">All Statuses</option>
<option value="generated">Generated</option>
<option value="applied">Applied</option>
<option value="interviewing">Interviewing</option>
<option value="offered">Offered</option>
<option value="rejected">Rejected</option>
<option value="withdrawn">Withdrawn</option>
</select>
<button onclick="loadLibrary()" class="secondary small">Refresh</button>
</div>

<div id="libraryContent">
<div class="resume-list" id="resumeList">
<div style="color:#666;padding:40px;text-align:center">
<p>No saved resumes yet</p>
<p style="font-size:0.9em;margin-top:10px">Generate and save resumes to build your library</p>
</div>
</div>
</div>
</div>

<!-- Resume Detail Modal -->
<div class="modal" id="resumeDetailModal">
<div class="modal-content" style="max-width:900px">
<div class="modal-header">
<h3 id="resumeDetailTitle">Resume Details</h3>
<button class="modal-close" onclick="closeResumeDetail()">&times;</button>
</div>
<div id="resumeDetailContent"></div>
</div>
</div>

<!-- Resources Panel -->
<div class="panel" id="resources">
<h2>ATS Best Practices & Resources</h2>
<div class="resources-grid">
<div class="resource-card">
<h4>Resume Format</h4>
<ul class="resource-list">
<li>Use standard section headers (Experience, Education, Skills)</li>
<li>Stick to common fonts (Arial, Calibri, Times New Roman)</li>
<li>Avoid tables, graphics, and complex formatting</li>
<li>Use .docx or .pdf format</li>
<li>Keep to 1-2 pages maximum</li>
</ul>
</div>
<div class="resource-card">
<h4>Keywords Strategy</h4>
<ul class="resource-list">
<li>Mirror exact phrases from job description</li>
<li>Include both acronyms and full terms (SQL, Structured Query Language)</li>
<li>Use industry-standard job titles</li>
<li>Include required certifications by name</li>
</ul>
</div>
<div class="resource-card">
<h4>Power Action Verbs</h4>
<ul class="resource-list">
<li><strong>Led</strong> - Led team of 5 engineers...</li>
<li><strong>Developed</strong> - Developed microservices...</li>
<li><strong>Increased</strong> - Increased revenue by 40%...</li>
<li><strong>Reduced</strong> - Reduced costs by $50K...</li>
<li><strong>Implemented</strong> - Implemented CI/CD pipeline...</li>
</ul>
</div>
<div class="resource-card">
<h4>Metrics That Matter</h4>
<ul class="resource-list">
<li>Revenue impact ($, %)</li>
<li>Time saved (hours, days)</li>
<li>Team size managed</li>
<li>User/customer numbers</li>
<li>Performance improvements (%)</li>
</ul>
</div>
</div>
</div>
</div>

<!-- Experience Modal -->
<div class="modal" id="experienceModal">
<div class="modal-content">
<div class="modal-header">
<h3 id="expModalTitle">Add Work Experience</h3>
<button class="modal-close" onclick="closeModal('experience')">&times;</button>
</div>
<input type="hidden" id="expEditIndex" value="-1">
<div class="form-group">
<label>Job Title</label>
<input type="text" id="expTitle" placeholder="Software Engineer">
</div>
<div class="form-group">
<label>Company</label>
<input type="text" id="expCompany" placeholder="Google">
</div>
<div class="form-group">
<label>Location</label>
<input type="text" id="expLocation" placeholder="Mountain View, CA">
</div>
<div class="grid">
<div class="form-group">
<label>Start Date</label>
<input type="month" id="expStart">
</div>
<div class="form-group">
<label>End Date (leave empty for current)</label>
<input type="month" id="expEnd">
</div>
</div>
<div class="form-group">
<label>Bullet Points (one per line - use metrics!)</label>
<textarea id="expBullets" rows="6" placeholder="Led development of microservices architecture serving 1M+ users
Reduced API response time by 40% through caching optimization
Mentored 3 junior developers, improving team velocity by 25%"></textarea>
</div>
<button onclick="saveExperience()">Save Experience</button>
</div>
</div>

<!-- Education Modal -->
<div class="modal" id="educationModal">
<div class="modal-content">
<div class="modal-header">
<h3>Add Education</h3>
<button class="modal-close" onclick="closeModal('education')">&times;</button>
</div>
<div class="form-group">
<label>Degree</label>
<input type="text" id="eduDegree" placeholder="Bachelor of Science in Computer Science">
</div>
<div class="form-group">
<label>Institution</label>
<input type="text" id="eduSchool" placeholder="University of California, Berkeley">
</div>
<div class="form-group">
<label>Location</label>
<input type="text" id="eduLocation" placeholder="Berkeley, CA">
</div>
<div class="grid">
<div class="form-group">
<label>Start Year</label>
<input type="number" id="eduStart" placeholder="2016">
</div>
<div class="form-group">
<label>End Year</label>
<input type="number" id="eduEnd" placeholder="2020">
</div>
</div>
<div class="form-group">
<label>GPA (optional)</label>
<input type="text" id="eduGPA" placeholder="3.8/4.0">
</div>
<div class="form-group">
<label>Relevant Coursework / Honors (optional)</label>
<textarea id="eduExtras" rows="3" placeholder="Dean's List, Data Structures, Machine Learning..."></textarea>
</div>
<button onclick="saveEducation()">Save Education</button>
</div>
</div>

<!-- Certification Modal -->
<div class="modal" id="certModal">
<div class="modal-content">
<div class="modal-header">
<h3>Add Certification</h3>
<button class="modal-close" onclick="closeModal('cert')">&times;</button>
</div>
<div class="form-group">
<label>Certification Name</label>
<input type="text" id="certName" placeholder="AWS Solutions Architect">
</div>
<div class="form-group">
<label>Issuing Organization</label>
<input type="text" id="certOrg" placeholder="Amazon Web Services">
</div>
<div class="form-group">
<label>Date Obtained</label>
<input type="month" id="certDate">
</div>
<div class="form-group">
<label>Credential ID (optional)</label>
<input type="text" id="certId" placeholder="ABC123XYZ">
</div>
<button onclick="saveCert()">Save Certification</button>
</div>
</div>

<script>
// State
const state = {
  profile: JSON.parse(localStorage.getItem('resumeProfile') || '{}'),
  experience: JSON.parse(localStorage.getItem('resumeExperience') || '[]'),
  education: JSON.parse(localStorage.getItem('resumeEducation') || '[]'),
  certs: JSON.parse(localStorage.getItem('resumeCerts') || '[]'),
  skills: JSON.parse(localStorage.getItem('resumeSkills') || '{"technical":[],"soft":[],"tools":[],"interests":[]}'),
  lastGenerated: null,
  libraryStats: null
};

// Tab switching
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    switchTab(tab.dataset.tab);
  });
});

function switchTab(tabName) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
  document.getElementById(tabName).classList.add('active');

  // Load data for specific tabs
  if (tabName === 'dashboard') {
    updateDashboard();
  } else if (tabName === 'library') {
    loadLibrary();
  }
}

// Dashboard functions
async function updateDashboard() {
  updateProfileCompleteness();

  if (!currentUser) {
    document.getElementById('statTotal').textContent = '0';
    document.getElementById('statAvgScore').textContent = '0%';
    document.getElementById('statApplied').textContent = '0';
    document.getElementById('statInterviewing').textContent = '0';
    document.getElementById('statOffered').textContent = '0';
    return;
  }

  try {
    const res = await fetch('/api/resumes/list?email=' + encodeURIComponent(currentUser.email));
    if (res.ok) {
      const data = await res.json();
      state.libraryStats = data.stats;

      document.getElementById('statTotal').textContent = data.stats.total || 0;
      document.getElementById('statAvgScore').textContent = (data.stats.avgScore || 0) + '%';
      document.getElementById('statApplied').textContent = data.stats.applied || 0;
      document.getElementById('statInterviewing').textContent = data.stats.interviewing || 0;
      document.getElementById('statOffered').textContent = data.stats.offered || 0;

      // Update library badge
      const badge = document.getElementById('libraryBadge');
      if (data.stats.total > 0) {
        badge.textContent = data.stats.total;
        badge.style.display = 'inline';
      } else {
        badge.style.display = 'none';
      }

      // Update recent activity
      updateRecentActivity(data.resumes.slice(0, 5));
    }
  } catch (e) {
    console.error('Failed to load stats:', e);
  }
}

function updateRecentActivity(resumes) {
  const container = document.getElementById('recentActivity');

  if (!resumes || resumes.length === 0) {
    container.innerHTML = `
      <div style="color:#666;padding:20px;text-align:center">
        <p>No recent activity</p>
        <p style="font-size:0.9em;margin-top:10px">Generate your first tailored resume to get started</p>
      </div>
    `;
    return;
  }

  container.innerHTML = resumes.map(r => `
    <div class="activity-item">
      <div class="activity-icon">${getStatusIcon(r.status)}</div>
      <div class="activity-content">
        <div class="activity-title">${r.company} - ${r.title}</div>
        <div class="activity-meta">
          <span class="status-badge ${r.status}">${r.status}</span>
          <span style="margin-left:10px">${formatDate(r.updatedAt || r.createdAt)}</span>
          <span style="margin-left:10px;color:${r.score >= 70 ? '#10b981' : r.score >= 50 ? '#f59e0b' : '#ef4444'}">${r.score}% match</span>
        </div>
      </div>
    </div>
  `).join('');
}

function getStatusIcon(status) {
  const icons = {
    generated: 'üìÑ',
    applied: 'üì§',
    interviewing: 'üé§',
    offered: 'üéâ',
    rejected: '‚ùå',
    withdrawn: '‚Ü©Ô∏è'
  };
  return icons[status] || 'üìÑ';
}

function formatDate(dateStr) {
  if (!dateStr) return '';
  const date = new Date(dateStr);
  const now = new Date();
  const diffMs = now - date;
  const diffMins = Math.floor(diffMs / 60000);
  const diffHours = Math.floor(diffMs / 3600000);
  const diffDays = Math.floor(diffMs / 86400000);

  if (diffMins < 60) return `${diffMins}m ago`;
  if (diffHours < 24) return `${diffHours}h ago`;
  if (diffDays < 7) return `${diffDays}d ago`;
  return date.toLocaleDateString();
}

function updateProfileCompleteness() {
  const checks = [
    { name: 'Full Name', value: state.profile.fullName },
    { name: 'Email', value: state.profile.email },
    { name: 'Phone', value: state.profile.phone },
    { name: 'Location', value: state.profile.location },
    { name: 'Summary', value: state.profile.summary },
    { name: 'Work Experience', value: state.experience.length > 0 },
    { name: 'Education', value: state.education.length > 0 },
    { name: 'Technical Skills', value: state.skills.technical?.length > 0 }
  ];

  const completed = checks.filter(c => c.value).length;
  const percent = Math.round((completed / checks.length) * 100);

  document.getElementById('completenessPercent').textContent = percent + '%';
  document.getElementById('completenessBar').style.width = percent + '%';

  const missing = checks.filter(c => !c.value).map(c => c.name);
  if (missing.length > 0) {
    document.getElementById('completenessHints').innerHTML = `
      <strong>Missing:</strong> ${missing.join(', ')}
    `;
  } else {
    document.getElementById('completenessHints').innerHTML = `
      <span style="color:#10b981">Profile complete! You're ready to generate tailored resumes.</span>
    `;
  }
}

// Load saved data into forms
function loadProfile() {
  if (state.profile.fullName) document.getElementById('fullName').value = state.profile.fullName;
  if (state.profile.email) document.getElementById('email').value = state.profile.email;
  if (state.profile.phone) document.getElementById('phone').value = state.profile.phone;
  if (state.profile.location) document.getElementById('location').value = state.profile.location;
  if (state.profile.linkedin) document.getElementById('linkedin').value = state.profile.linkedin;
  if (state.profile.github) document.getElementById('github').value = state.profile.github;
  if (state.profile.portfolio) document.getElementById('portfolio').value = state.profile.portfolio;
  if (state.profile.summary) document.getElementById('summary').value = state.profile.summary;
}

function saveProfile() {
  state.profile = {
    fullName: document.getElementById('fullName').value,
    email: document.getElementById('email').value,
    phone: document.getElementById('phone').value,
    location: document.getElementById('location').value,
    linkedin: document.getElementById('linkedin').value,
    github: document.getElementById('github').value,
    portfolio: document.getElementById('portfolio').value,
    summary: document.getElementById('summary').value
  };
  localStorage.setItem('resumeProfile', JSON.stringify(state.profile));
  saveUserData();
  alert('Profile saved!');
}

// Modal functions
function openModal(type) {
  if (type === 'experience') {
    document.getElementById('expModalTitle').textContent = 'Add Work Experience';
    document.getElementById('expEditIndex').value = '-1';
  }
  document.getElementById(type + 'Modal').classList.add('active');
}

function closeModal(type) {
  document.getElementById(type + 'Modal').classList.remove('active');
  // Clear form
  if (type === 'experience') {
    ['expTitle', 'expCompany', 'expLocation', 'expStart', 'expEnd', 'expBullets'].forEach(id => document.getElementById(id).value = '');
    document.getElementById('expEditIndex').value = '-1';
  }
}

// Experience functions
function renderExperience() {
  const list = document.getElementById('experienceList');
  list.innerHTML = state.experience.map((exp, i) => `
    <div class="item">
      <div class="item-header">
        <div>
          <div class="item-title">${exp.title} at ${exp.company}</div>
          <div class="item-subtitle">${exp.location} | ${exp.start} - ${exp.end || 'Present'}</div>
        </div>
        <div class="item-actions">
          <button class="secondary" onclick="editExperience(${i})">Edit</button>
          <button class="danger" onclick="deleteExperience(${i})">Delete</button>
        </div>
      </div>
      <div class="bullets">
        ${exp.bullets.map(b => `<div class="bullet"><span class="bullet-dot">‚Ä¢</span><span>${b}</span></div>`).join('')}
      </div>
    </div>
  `).join('');
}

function editExperience(i) {
  const exp = state.experience[i];
  document.getElementById('expModalTitle').textContent = 'Edit Work Experience';
  document.getElementById('expEditIndex').value = i;
  document.getElementById('expTitle').value = exp.title;
  document.getElementById('expCompany').value = exp.company;
  document.getElementById('expLocation').value = exp.location || '';
  document.getElementById('expStart').value = exp.start;
  document.getElementById('expEnd').value = exp.end || '';
  document.getElementById('expBullets').value = exp.bullets.join('\n');
  openModal('experience');
}

function saveExperience() {
  const exp = {
    title: document.getElementById('expTitle').value,
    company: document.getElementById('expCompany').value,
    location: document.getElementById('expLocation').value,
    start: document.getElementById('expStart').value,
    end: document.getElementById('expEnd').value,
    bullets: document.getElementById('expBullets').value.split('\n').filter(b => b.trim())
  };

  const editIndex = parseInt(document.getElementById('expEditIndex').value);
  if (editIndex >= 0) {
    state.experience[editIndex] = exp;
  } else {
    state.experience.push(exp);
  }

  localStorage.setItem('resumeExperience', JSON.stringify(state.experience));
  closeModal('experience');
  renderExperience();
  saveUserData();
}

function deleteExperience(i) {
  if (confirm('Delete this experience?')) {
    state.experience.splice(i, 1);
    localStorage.setItem('resumeExperience', JSON.stringify(state.experience));
    renderExperience();
    saveUserData();
  }
}

// Education functions
function renderEducation() {
  const list = document.getElementById('educationList');
  list.innerHTML = state.education.map((edu, i) => `
    <div class="item">
      <div class="item-header">
        <div>
          <div class="item-title">${edu.degree}</div>
          <div class="item-subtitle">${edu.school} | ${edu.start} - ${edu.end}${edu.gpa ? ' | GPA: ' + edu.gpa : ''}</div>
        </div>
        <div class="item-actions">
          <button class="danger" onclick="deleteEducation(${i})">Delete</button>
        </div>
      </div>
      ${edu.extras ? `<div style="color:#888;margin-top:10px">${edu.extras}</div>` : ''}
    </div>
  `).join('');
}

function saveEducation() {
  const edu = {
    degree: document.getElementById('eduDegree').value,
    school: document.getElementById('eduSchool').value,
    location: document.getElementById('eduLocation').value,
    start: document.getElementById('eduStart').value,
    end: document.getElementById('eduEnd').value,
    gpa: document.getElementById('eduGPA').value,
    extras: document.getElementById('eduExtras').value
  };
  state.education.push(edu);
  localStorage.setItem('resumeEducation', JSON.stringify(state.education));
  closeModal('education');
  renderEducation();
  saveUserData();
  ['eduDegree', 'eduSchool', 'eduLocation', 'eduStart', 'eduEnd', 'eduGPA', 'eduExtras'].forEach(id => document.getElementById(id).value = '');
}

function deleteEducation(i) {
  if (confirm('Delete this education?')) {
    state.education.splice(i, 1);
    localStorage.setItem('resumeEducation', JSON.stringify(state.education));
    renderEducation();
    saveUserData();
  }
}

// Certification functions
function renderCerts() {
  const list = document.getElementById('certsList');
  list.innerHTML = state.certs.map((cert, i) => `
    <div class="item">
      <div class="item-header">
        <div>
          <div class="item-title">${cert.name}</div>
          <div class="item-subtitle">${cert.org} | ${cert.date}${cert.id ? ' | ID: ' + cert.id : ''}</div>
        </div>
        <div class="item-actions">
          <button class="danger" onclick="deleteCert(${i})">Delete</button>
        </div>
      </div>
    </div>
  `).join('');
}

function saveCert() {
  const cert = {
    name: document.getElementById('certName').value,
    org: document.getElementById('certOrg').value,
    date: document.getElementById('certDate').value,
    id: document.getElementById('certId').value
  };
  state.certs.push(cert);
  localStorage.setItem('resumeCerts', JSON.stringify(state.certs));
  closeModal('cert');
  renderCerts();
  saveUserData();
  ['certName', 'certOrg', 'certDate', 'certId'].forEach(id => document.getElementById(id).value = '');
}

function deleteCert(i) {
  if (confirm('Delete this certification?')) {
    state.certs.splice(i, 1);
    localStorage.setItem('resumeCerts', JSON.stringify(state.certs));
    renderCerts();
    saveUserData();
  }
}

// Skills functions
function renderSkills() {
  ['technical', 'soft', 'tools', 'interests'].forEach(type => {
    const container = document.getElementById(type === 'technical' ? 'technicalSkills' : type === 'soft' ? 'softSkills' : type);
    const skills = state.skills[type] || [];
    container.innerHTML = skills.map((s, i) => `
      <span class="tag">${s}<span class="tag-remove" onclick="removeSkill('${type}', ${i})">&times;</span></span>
    `).join('');
  });
}

function addSkill(type) {
  const inputId = type === 'technical' ? 'techSkillInput' : type === 'soft' ? 'softSkillInput' : type === 'tools' ? 'toolInput' : 'interestInput';
  const input = document.getElementById(inputId);
  const value = input.value.trim();
  if (value) {
    if (!state.skills[type]) state.skills[type] = [];
    state.skills[type].push(value);
    localStorage.setItem('resumeSkills', JSON.stringify(state.skills));
    renderSkills();
    input.value = '';
    saveUserData();
  }
}

function removeSkill(type, i) {
  state.skills[type].splice(i, 1);
  localStorage.setItem('resumeSkills', JSON.stringify(state.skills));
  renderSkills();
  saveUserData();
}

// Enter key for skill inputs
['techSkillInput', 'softSkillInput', 'toolInput', 'interestInput'].forEach(id => {
  document.getElementById(id).addEventListener('keypress', e => {
    if (e.key === 'Enter') {
      e.preventDefault();
      const type = id === 'techSkillInput' ? 'technical' : id === 'softSkillInput' ? 'soft' : id === 'toolInput' ? 'tools' : 'interests';
      addSkill(type);
    }
  });
});

// Generate resume
async function generateResume() {
  const jobDescription = document.getElementById('jobDescription').value.trim();
  if (!jobDescription) {
    alert('Please paste a job description');
    return;
  }

  document.getElementById('loading').classList.add('active');
  document.getElementById('output').style.display = 'none';

  const payload = {
    profile: state.profile,
    experience: state.experience,
    education: state.education,
    certs: state.certs,
    skills: state.skills,
    jobDescription: jobDescription,
    targetRole: document.getElementById('targetRole').value,
    additionalInstructions: document.getElementById('additionalInstructions').value
  };

  try {
    const res = await fetch('/api/generate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    if (!res.ok) throw new Error('API error: ' + res.status);

    const data = await res.json();

    // Store for saving to library
    state.lastGenerated = {
      company: document.getElementById('jobCompany').value || 'Unknown Company',
      title: document.getElementById('targetRole').value || 'Position',
      jobDescription: jobDescription,
      score: data.score,
      matchedKeywords: data.matchedKeywords,
      missingKeywords: data.missingKeywords,
      tailoredSummary: data.tailoredSummary,
      resume: data.resume,
      recruiterAssessment: data.recruiterAssessment
    };

    document.getElementById('atsScore').textContent = data.score + '%';
    document.getElementById('keywordAnalysis').innerHTML = `
      <div style="margin-top:15px">
        <strong>Matched Keywords:</strong>
        ${data.matchedKeywords.map(k => `<span class="keyword-match">${k}</span>`).join(', ')}
      </div>
      <div style="margin-top:10px">
        <strong>Consider Adding:</strong>
        ${data.missingKeywords.map(k => `<span class="keyword-missing">${k}</span>`).join(', ')}
      </div>
    `;
    document.getElementById('relevanceRankings').textContent = data.relevanceRankings || 'Not available';
    document.getElementById('tailoredSummary').textContent = data.tailoredSummary || 'Not available';
    document.getElementById('resumeOutput').textContent = data.resume;
    document.getElementById('recruiterAssessment').innerHTML = (data.recruiterAssessment || 'Not available').replace(/\n/g, '<br>');
    document.getElementById('output').style.display = 'block';
  } catch (e) {
    alert('Error generating resume: ' + e.message);
  } finally {
    document.getElementById('loading').classList.remove('active');
  }
}

async function saveCurrentResume() {
  if (!currentUser) {
    alert('Please sign in to save resumes');
    return;
  }

  if (!state.lastGenerated) {
    alert('No resume to save');
    return;
  }

  const btn = document.getElementById('saveToLibraryBtn');
  btn.disabled = true;
  btn.textContent = 'Saving...';

  try {
    const res = await fetch('/api/resumes/save', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        email: currentUser.email,
        ...state.lastGenerated
      })
    });

    if (!res.ok) throw new Error('Failed to save');

    const data = await res.json();
    btn.textContent = 'Saved!';
    setTimeout(() => {
      btn.textContent = 'Save to Library';
      btn.disabled = false;
    }, 2000);

    // Update dashboard stats
    updateDashboard();
  } catch (e) {
    alert('Error saving resume: ' + e.message);
    btn.textContent = 'Save to Library';
    btn.disabled = false;
  }
}

function copyResume() {
  const text = document.getElementById('resumeOutput').textContent;
  navigator.clipboard.writeText(text).then(() => {
    alert('Copied to clipboard!');
  });
}

// Batch processing functions
function addBatchJob() {
  const container = document.getElementById('batchJobsList');
  const jobs = container.querySelectorAll('.batch-job');

  if (jobs.length >= 5) {
    alert('Maximum 5 jobs allowed');
    return;
  }

  const index = jobs.length;
  const jobHtml = `
    <div class="batch-job" data-index="${index}">
      <div class="batch-job-header">
        <div class="batch-job-number">${index + 1}</div>
        <button class="remove-job" onclick="removeBatchJob(${index})">&times;</button>
      </div>
      <div class="grid-2">
        <div class="form-group">
          <label>Company Name</label>
          <input type="text" class="batch-company" placeholder="e.g., Google">
        </div>
        <div class="form-group">
          <label>Job Title</label>
          <input type="text" class="batch-title" placeholder="e.g., Software Engineer">
        </div>
      </div>
      <div class="form-group">
        <label>Job URL (optional)</label>
        <input type="url" class="batch-url" placeholder="https://...">
      </div>
      <div class="form-group">
        <label>Job Description</label>
        <textarea class="batch-jd" rows="6" placeholder="Paste the job description here..."></textarea>
      </div>
    </div>
  `;

  container.insertAdjacentHTML('beforeend', jobHtml);

  // Show all remove buttons if more than 1 job
  if (jobs.length >= 1) {
    container.querySelectorAll('.remove-job').forEach(btn => btn.style.display = 'block');
  }

  // Hide add button if at max
  if (index >= 4) {
    document.getElementById('addJobBtn').style.display = 'none';
  }
}

function removeBatchJob(index) {
  const container = document.getElementById('batchJobsList');
  const job = container.querySelector(`[data-index="${index}"]`);
  if (job) job.remove();

  // Renumber remaining jobs
  const jobs = container.querySelectorAll('.batch-job');
  jobs.forEach((job, i) => {
    job.dataset.index = i;
    job.querySelector('.batch-job-number').textContent = i + 1;
    job.querySelector('.remove-job').setAttribute('onclick', `removeBatchJob(${i})`);
  });

  // Hide remove button if only 1 job left
  if (jobs.length <= 1) {
    jobs[0]?.querySelector('.remove-job')?.style.setProperty('display', 'none');
  }

  // Show add button
  document.getElementById('addJobBtn').style.display = 'block';
}

async function processBatchJobs() {
  const jobElements = document.querySelectorAll('.batch-job');
  const jobs = [];

  jobElements.forEach(el => {
    const jd = el.querySelector('.batch-jd').value.trim();
    if (jd) {
      jobs.push({
        company: el.querySelector('.batch-company').value.trim(),
        title: el.querySelector('.batch-title').value.trim(),
        url: el.querySelector('.batch-url').value.trim(),
        jobDescription: jd
      });
    }
  });

  if (jobs.length === 0) {
    alert('Please add at least one job description');
    return;
  }

  document.getElementById('batchLoading').classList.add('active');
  document.getElementById('batchResults').style.display = 'none';

  try {
    const res = await fetch('/api/batch/process', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        profile: state.profile,
        experience: state.experience,
        education: state.education,
        certs: state.certs,
        skills: state.skills,
        jobs
      })
    });

    if (!res.ok) throw new Error('Batch processing failed');

    const data = await res.json();
    displayBatchResults(data);
  } catch (e) {
    alert('Error processing jobs: ' + e.message);
  } finally {
    document.getElementById('batchLoading').classList.remove('active');
  }
}

function displayBatchResults(data) {
  document.getElementById('batchResults').style.display = 'block';

  // Summary
  document.getElementById('batchSummary').textContent = data.comparison.summary;
  document.getElementById('batchRecommendation').innerHTML = `
    <strong>Recommendation:</strong> ${data.comparison.recommendation}
    ${data.comparison.frequentlyMissing?.length > 0 ? `<br><br><strong>Skills to Develop:</strong> ${data.comparison.frequentlyMissing.join(', ')}` : ''}
  `;

  // Rankings
  document.getElementById('batchRankings').innerHTML = data.comparison.rankings.map(r => `
    <div class="ranking-item">
      <div class="ranking-position">#${r.rank}</div>
      <div class="ranking-details">
        <div class="ranking-company">${r.company}</div>
        <div class="ranking-title">${r.title}</div>
      </div>
      <div class="resume-score ${r.score >= 70 ? 'high' : r.score >= 50 ? 'medium' : 'low'}">${r.score}%</div>
      <span class="status-badge ${r.recommendation.toLowerCase().replace(' ', '-')}">${r.recommendation}</span>
    </div>
  `).join('');

  // Detailed results
  document.getElementById('batchDetailedResults').innerHTML = data.results.map((r, i) => `
    <div class="card" style="margin-bottom:20px">
      <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:15px">
        <div>
          <h4 style="margin:0">${r.company} - ${r.title}</h4>
          ${r.url ? `<a href="${r.url}" target="_blank" style="color:#6366f1;font-size:0.9em">View Job Posting</a>` : ''}
        </div>
        <div class="resume-score ${r.score >= 70 ? 'high' : r.score >= 50 ? 'medium' : 'low'}">${r.score}%</div>
      </div>

      ${r.error ? `<div style="color:#ef4444">Error: ${r.error}</div>` : `
        <div style="margin-bottom:15px">
          <strong>Strengths:</strong>
          <ul style="margin:5px 0 0 20px;color:#aaa">
            ${r.strengths.map(s => `<li>${s}</li>`).join('')}
          </ul>
        </div>

        <div style="margin-bottom:15px">
          <strong>Concerns:</strong>
          <ul style="margin:5px 0 0 20px;color:#aaa">
            ${r.concerns.map(c => `<li>${c}</li>`).join('')}
          </ul>
        </div>

        <div style="margin-bottom:15px">
          <strong>Matched Keywords:</strong>
          <span style="color:#10b981">${r.matchedKeywords.slice(0, 10).join(', ')}</span>
        </div>

        <div style="margin-bottom:15px">
          <strong>Missing Keywords:</strong>
          <span style="color:#ef4444">${r.missingKeywords.slice(0, 10).join(', ')}</span>
        </div>

        <details>
          <summary style="cursor:pointer;color:#6366f1">View Tailored Resume</summary>
          <pre style="background:#222;padding:15px;border-radius:8px;margin-top:10px;white-space:pre-wrap;font-size:0.85em">${r.resume}</pre>
        </details>

        <div style="margin-top:15px">
          <button onclick="saveBatchResult(${i})" class="small success">Save to Library</button>
        </div>
      `}
    </div>
  `).join('');

  // Store results for saving
  state.batchResults = data.results;
}

async function saveBatchResult(index) {
  if (!currentUser) {
    alert('Please sign in to save resumes');
    return;
  }

  const result = state.batchResults[index];
  if (!result || result.error) return;

  try {
    const res = await fetch('/api/resumes/save', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        email: currentUser.email,
        company: result.company,
        title: result.title,
        jobUrl: result.url,
        score: result.score,
        matchedKeywords: result.matchedKeywords,
        missingKeywords: result.missingKeywords,
        tailoredSummary: result.tailoredSummary,
        resume: result.resume
      })
    });

    if (!res.ok) throw new Error('Failed to save');
    alert('Saved to library!');
    updateDashboard();
  } catch (e) {
    alert('Error saving: ' + e.message);
  }
}

// Library functions
async function loadLibrary() {
  if (!currentUser) {
    document.getElementById('resumeList').innerHTML = `
      <div style="color:#666;padding:40px;text-align:center">
        <p>Please sign in to view your resume library</p>
      </div>
    `;
    return;
  }

  const status = document.getElementById('libraryStatusFilter').value;

  try {
    const res = await fetch(`/api/resumes/list?email=${encodeURIComponent(currentUser.email)}&status=${status}`);
    if (!res.ok) throw new Error('Failed to load');

    const data = await res.json();

    if (data.resumes.length === 0) {
      document.getElementById('resumeList').innerHTML = `
        <div style="color:#666;padding:40px;text-align:center">
          <p>No resumes found${status !== 'all' ? ' with this status' : ''}</p>
          <p style="font-size:0.9em;margin-top:10px">Generate and save resumes to build your library</p>
        </div>
      `;
      return;
    }

    document.getElementById('resumeList').innerHTML = data.resumes.map(r => `
      <div class="resume-card" onclick="viewResumeDetail('${r.id}')">
        <div class="resume-card-header">
          <div>
            <div class="resume-company">${r.company}</div>
            <div class="resume-title">${r.title}</div>
          </div>
          <div class="resume-score ${r.score >= 70 ? 'high' : r.score >= 50 ? 'medium' : 'low'}">${r.score}%</div>
        </div>
        <div style="margin:10px 0">
          <span class="status-badge ${r.status}">${r.status}</span>
        </div>
        <div class="resume-meta">
          <span>Created ${formatDate(r.createdAt)}</span>
          ${r.matchedKeywords?.length > 0 ? `<span>${r.matchedKeywords.length} keywords matched</span>` : ''}
        </div>
      </div>
    `).join('');

  } catch (e) {
    console.error('Load library error:', e);
    document.getElementById('resumeList').innerHTML = `
      <div style="color:#ef4444;padding:20px;text-align:center">
        Error loading library: ${e.message}
      </div>
    `;
  }
}

async function viewResumeDetail(resumeId) {
  if (!currentUser) return;

  try {
    const res = await fetch('/api/resumes/list', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email: currentUser.email, resumeId })
    });

    if (!res.ok) throw new Error('Failed to load resume');

    const resume = await res.json();
    state.currentResumeDetail = resume;

    document.getElementById('resumeDetailTitle').textContent = `${resume.company} - ${resume.title}`;
    document.getElementById('resumeDetailContent').innerHTML = `
      <div style="display:flex;gap:20px;margin-bottom:20px;flex-wrap:wrap">
        <div class="stat-card" style="flex:1;min-width:150px">
          <div class="stat-value" style="font-size:2em">${resume.score}%</div>
          <div class="stat-label">Match Score</div>
        </div>
        <div style="flex:2;min-width:200px">
          <label style="display:block;margin-bottom:8px;color:#888">Application Status</label>
          <select id="resumeStatusSelect" onchange="updateResumeStatus('${resumeId}')" style="width:auto;min-width:200px">
            <option value="generated" ${resume.status === 'generated' ? 'selected' : ''}>Generated</option>
            <option value="applied" ${resume.status === 'applied' ? 'selected' : ''}>Applied</option>
            <option value="interviewing" ${resume.status === 'interviewing' ? 'selected' : ''}>Interviewing</option>
            <option value="offered" ${resume.status === 'offered' ? 'selected' : ''}>Offered</option>
            <option value="rejected" ${resume.status === 'rejected' ? 'selected' : ''}>Rejected</option>
            <option value="withdrawn" ${resume.status === 'withdrawn' ? 'selected' : ''}>Withdrawn</option>
          </select>
        </div>
      </div>

      ${resume.jobUrl ? `<p style="margin-bottom:15px"><a href="${resume.jobUrl}" target="_blank" style="color:#6366f1">View Original Job Posting</a></p>` : ''}

      <div style="margin-bottom:20px">
        <strong>Matched Keywords:</strong>
        <div style="margin-top:8px">
          ${(resume.matchedKeywords || []).map(k => `<span class="tag" style="background:#10b981;color:#fff">${k}</span>`).join(' ')}
        </div>
      </div>

      <div style="margin-bottom:20px">
        <strong>Missing Keywords:</strong>
        <div style="margin-top:8px">
          ${(resume.missingKeywords || []).map(k => `<span class="tag" style="background:#ef4444;color:#fff">${k}</span>`).join(' ')}
        </div>
      </div>

      ${resume.tailoredSummary ? `
        <div class="card" style="margin-bottom:20px">
          <h4 style="color:#6366f1;margin-bottom:10px">Tailored Summary</h4>
          <p style="color:#ddd;font-style:italic">${resume.tailoredSummary}</p>
        </div>
      ` : ''}

      <div class="card" style="margin-bottom:20px">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px">
          <h4 style="color:#00ff88;margin:0">Resume</h4>
          <button onclick="copyResumeFromDetail()" class="secondary small">Copy</button>
        </div>
        <pre style="white-space:pre-wrap;font-family:'Courier New',monospace;line-height:1.8;color:#aaa">${resume.resume || 'No resume content'}</pre>
      </div>

      ${resume.recruiterAssessment ? `
        <div class="card" style="background:linear-gradient(135deg,#1a1a2e,#16213e)">
          <h4 style="color:#f59e0b;margin-bottom:10px">Recruiter Assessment</h4>
          <div style="white-space:pre-wrap;line-height:1.8">${resume.recruiterAssessment}</div>
        </div>
      ` : ''}

      <div class="form-group" style="margin-top:20px">
        <label>Notes</label>
        <textarea id="resumeNotes" rows="3" placeholder="Add notes about this application...">${resume.notes || ''}</textarea>
        <button onclick="saveResumeNotes('${resumeId}')" class="secondary small" style="margin-top:10px">Save Notes</button>
      </div>

      <div style="margin-top:30px;padding-top:20px;border-top:1px solid #333">
        <button onclick="deleteResume('${resumeId}')" class="danger">Delete Resume</button>
      </div>
    `;

    document.getElementById('resumeDetailModal').classList.add('active');

  } catch (e) {
    alert('Error loading resume: ' + e.message);
  }
}

function closeResumeDetail() {
  document.getElementById('resumeDetailModal').classList.remove('active');
}

function copyResumeFromDetail() {
  if (state.currentResumeDetail?.resume) {
    navigator.clipboard.writeText(state.currentResumeDetail.resume).then(() => {
      alert('Copied to clipboard!');
    });
  }
}

async function updateResumeStatus(resumeId) {
  if (!currentUser) return;

  const status = document.getElementById('resumeStatusSelect').value;

  try {
    const res = await fetch('/api/applications/update', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        email: currentUser.email,
        resumeId,
        status
      })
    });

    if (!res.ok) throw new Error('Failed to update status');

    loadLibrary();
    updateDashboard();
  } catch (e) {
    alert('Error updating status: ' + e.message);
  }
}

async function saveResumeNotes(resumeId) {
  if (!currentUser) return;

  const notes = document.getElementById('resumeNotes').value;

  try {
    const res = await fetch('/api/applications/update', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        email: currentUser.email,
        resumeId,
        notes
      })
    });

    if (!res.ok) throw new Error('Failed to save notes');

    alert('Notes saved!');
  } catch (e) {
    alert('Error saving notes: ' + e.message);
  }
}

async function deleteResume(resumeId) {
  if (!currentUser) return;

  if (!confirm('Are you sure you want to delete this resume? This cannot be undone.')) {
    return;
  }

  try {
    const res = await fetch('/api/resumes/delete', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        email: currentUser.email,
        resumeId
      })
    });

    if (!res.ok) throw new Error('Failed to delete');

    closeResumeDetail();
    loadLibrary();
    updateDashboard();
  } catch (e) {
    alert('Error deleting resume: ' + e.message);
  }
}

// Auto-save on input change
function setupAutoSave() {
  // Profile fields
  ['fullName', 'email', 'phone', 'location', 'linkedin', 'github', 'portfolio', 'summary'].forEach(id => {
    const el = document.getElementById(id);
    if (el) {
      el.addEventListener('input', () => {
        state.profile[id] = el.value;
        localStorage.setItem('resumeProfile', JSON.stringify(state.profile));
        showSaveStatus();
      });
    }
  });
}

function showSaveStatus() {
  const status = document.getElementById('saveStatus');
  if (status) {
    status.textContent = 'Saved!';
    setTimeout(() => { status.textContent = ''; }, 2000);
  }
}

// Parse resume with AI
async function parseResumeWithAI() {
  const text = document.getElementById('importResume').value.trim();
  if (!text) {
    alert('Please paste your resume text first');
    return;
  }

  const status = document.getElementById('parseStatus');
  status.textContent = 'Parsing with AI...';

  try {
    const res = await fetch('/api/parse', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ resumeText: text })
    });

    if (!res.ok) throw new Error('Parse failed: ' + res.status);

    const data = await res.json();

    // Fill in profile fields
    if (data.profile) {
      Object.keys(data.profile).forEach(key => {
        const el = document.getElementById(key);
        if (el && data.profile[key]) {
          el.value = data.profile[key];
          state.profile[key] = data.profile[key];
        }
      });
      localStorage.setItem('resumeProfile', JSON.stringify(state.profile));
    }

    // Add experience
    if (data.experience && data.experience.length > 0) {
      state.experience = data.experience;
      localStorage.setItem('resumeExperience', JSON.stringify(state.experience));
      renderExperience();
    }

    // Add education
    if (data.education && data.education.length > 0) {
      state.education = data.education;
      localStorage.setItem('resumeEducation', JSON.stringify(state.education));
      renderEducation();
    }

    // Add skills
    if (data.skills) {
      state.skills = { ...state.skills, ...data.skills };
      localStorage.setItem('resumeSkills', JSON.stringify(state.skills));
      renderSkills();
    }

    status.textContent = 'Parsed successfully!';
    document.getElementById('resumeTextModal').classList.remove('active');
    saveUserData();
    setTimeout(() => { status.textContent = ''; }, 3000);

  } catch (e) {
    status.textContent = 'Error: ' + e.message;
  }
}

// Google OAuth
const GOOGLE_CLIENT_ID = '';
let currentUser = null;

async function loginWithGoogle() {
  const client = google.accounts.oauth2.initTokenClient({
    client_id: GOOGLE_CLIENT_ID,
    scope: 'email profile',
    callback: async (response) => {
      if (response.access_token) {
        const userRes = await fetch('https://www.googleapis.com/oauth2/v2/userinfo', {
          headers: { Authorization: 'Bearer ' + response.access_token }
        });
        const user = await userRes.json();
        currentUser = user;
        localStorage.setItem('user', JSON.stringify(user));
        updateAuthUI();
        loadUserData();
        updateDashboard();
      }
    }
  });
  client.requestAccessToken();
}

function logout() {
  currentUser = null;
  localStorage.removeItem('user');
  updateAuthUI();
  updateDashboard();
}

function updateAuthUI() {
  const authSection = document.getElementById('authSection');
  const userInfo = document.getElementById('userInfo');
  const userName = document.getElementById('userName');

  if (currentUser) {
    authSection.style.display = 'none';
    userInfo.style.display = 'block';
    userName.textContent = currentUser.name || currentUser.email;
  } else {
    authSection.style.display = 'block';
    userInfo.style.display = 'none';
  }
}

async function loadUserData() {
  if (!currentUser) return;
  try {
    const res = await fetch('/api/user/load?email=' + encodeURIComponent(currentUser.email));
    if (res.ok) {
      const data = await res.json();
      if (data.profile) state.profile = data.profile;
      if (data.experience) state.experience = data.experience;
      if (data.education) state.education = data.education;
      if (data.certs) state.certs = data.certs;
      if (data.skills) state.skills = data.skills;
      loadProfile();
      renderExperience();
      renderEducation();
      renderCerts();
      renderSkills();
    }
  } catch (e) {
    console.log('No saved data found');
  }
}

async function saveUserData() {
  if (!currentUser) return;
  try {
    await fetch('/api/user/save', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        email: currentUser.email,
        profile: state.profile,
        experience: state.experience,
        education: state.education,
        certs: state.certs,
        skills: state.skills
      })
    });
  } catch (e) {
    console.error('Save failed:', e);
  }
}

// LinkedIn ZIP Parser
async function parseLinkedInZip(file) {
  if (!file) return;
  const status = document.getElementById('importStatus');
  status.textContent = 'Reading LinkedIn data...';

  try {
    const JSZip = await import('https://cdn.jsdelivr.net/npm/jszip@3.10.1/+esm');
    const zip = await JSZip.default.loadAsync(file);

    let profileData = {};
    let positions = [];
    let education = [];
    let skills = [];

    // Parse Profile.csv
    const profileFile = zip.file(/Profile\.csv/i)[0];
    if (profileFile) {
      const text = await profileFile.async('text');
      const lines = text.split('\n');
      if (lines.length > 1) {
        const headers = parseCSVLine(lines[0]);
        const values = parseCSVLine(lines[1]);
        headers.forEach((h, i) => {
          if (h.toLowerCase().includes('first')) profileData.firstName = values[i];
          if (h.toLowerCase().includes('last')) profileData.lastName = values[i];
          if (h.toLowerCase().includes('headline')) profileData.summary = values[i];
          if (h.toLowerCase().includes('email')) profileData.email = values[i];
        });
      }
    }

    // Parse Positions.csv
    const positionsFile = zip.file(/Positions\.csv/i)[0];
    if (positionsFile) {
      const text = await positionsFile.async('text');
      const lines = text.split('\n');
      if (lines.length > 1) {
        const headers = parseCSVLine(lines[0]);
        for (let i = 1; i < lines.length; i++) {
          if (!lines[i].trim()) continue;
          const values = parseCSVLine(lines[i]);
          const pos = {};
          headers.forEach((h, idx) => {
            const hl = h.toLowerCase();
            if (hl.includes('company')) pos.company = values[idx];
            if (hl.includes('title')) pos.title = values[idx];
            if (hl.includes('description')) pos.description = values[idx];
            if (hl.includes('location')) pos.location = values[idx];
            if (hl.includes('started on')) pos.start = values[idx];
            if (hl.includes('finished on')) pos.end = values[idx];
          });
          if (pos.company || pos.title) positions.push(pos);
        }
      }
    }

    // Parse Education.csv
    const eduFile = zip.file(/Education\.csv/i)[0];
    if (eduFile) {
      const text = await eduFile.async('text');
      const lines = text.split('\n');
      if (lines.length > 1) {
        const headers = parseCSVLine(lines[0]);
        for (let i = 1; i < lines.length; i++) {
          if (!lines[i].trim()) continue;
          const values = parseCSVLine(lines[i]);
          const edu = {};
          headers.forEach((h, idx) => {
            const hl = h.toLowerCase();
            if (hl.includes('school')) edu.school = values[idx];
            if (hl.includes('degree')) edu.degree = values[idx];
            if (hl.includes('start')) edu.start = values[idx];
            if (hl.includes('end')) edu.end = values[idx];
          });
          if (edu.school) education.push(edu);
        }
      }
    }

    // Parse Skills.csv
    const skillsFile = zip.file(/Skills\.csv/i)[0];
    if (skillsFile) {
      const text = await skillsFile.async('text');
      const lines = text.split('\n');
      for (let i = 1; i < lines.length; i++) {
        const skill = lines[i].trim().replace(/"/g, '');
        if (skill) skills.push(skill);
      }
    }

    // Apply to state
    if (profileData.firstName) {
      state.profile.fullName = (profileData.firstName + ' ' + (profileData.lastName || '')).trim();
    }
    if (profileData.email) state.profile.email = profileData.email;
    if (profileData.summary) state.profile.summary = profileData.summary;
    loadProfile();

    if (positions.length > 0) {
      state.experience = positions.map(p => ({
        title: p.title || '',
        company: p.company || '',
        location: p.location || '',
        start: p.start || '',
        end: p.end || '',
        bullets: p.description ? p.description.split(/[.;]\s+/).filter(b => b.trim()) : []
      }));
      localStorage.setItem('resumeExperience', JSON.stringify(state.experience));
      renderExperience();
    }

    if (education.length > 0) {
      state.education = education.map(e => ({
        degree: e.degree || '',
        school: e.school || '',
        start: e.start || '',
        end: e.end || '',
        location: '',
        gpa: '',
        extras: ''
      }));
      localStorage.setItem('resumeEducation', JSON.stringify(state.education));
      renderEducation();
    }

    if (skills.length > 0) {
      state.skills.technical = [...new Set([...state.skills.technical, ...skills])];
      localStorage.setItem('resumeSkills', JSON.stringify(state.skills));
      renderSkills();
    }

    localStorage.setItem('resumeProfile', JSON.stringify(state.profile));
    status.textContent = 'LinkedIn data imported! Found ' + positions.length + ' positions, ' + education.length + ' education, ' + skills.length + ' skills';
    saveUserData();

  } catch (e) {
    status.textContent = 'Error parsing ZIP: ' + e.message;
    console.error(e);
  }
}

function parseCSVLine(line) {
  const result = [];
  let current = '';
  let inQuotes = false;
  for (let i = 0; i < line.length; i++) {
    const char = line[i];
    if (char === '"') {
      inQuotes = !inQuotes;
    } else if (char === ',' && !inQuotes) {
      result.push(current.trim());
      current = '';
    } else {
      current += char;
    }
  }
  result.push(current.trim());
  return result;
}

// Check for saved user on load
const savedUser = localStorage.getItem('user');
if (savedUser) {
  currentUser = JSON.parse(savedUser);
  updateAuthUI();
}

// Initialize
loadProfile();
renderExperience();
renderEducation();
renderCerts();
renderSkills();
setupAutoSave();
updateDashboard();
console.log('Claude Resume initialized');
</script>
<script src="https://accounts.google.com/gsi/client" async defer></script>
</body>
</html>
